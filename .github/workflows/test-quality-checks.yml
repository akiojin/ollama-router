# Test: Quality Checks Workflow
# æ©Ÿèƒ½ID: SPEC-47c6f44c
# ç›®çš„: quality-checks.ymlã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆï¼ˆTDD - REDï¼‰
# ã“ã®ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…å‰ãªã®ã§å¤±æ•—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

name: Test Quality Checks

on:
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œå°‚ç”¨ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
  push:
    branches: [test/**]

jobs:
  test-workflow-exists:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check if quality-checks.yml exists
        run: |
          if [ ! -f .github/workflows/quality-checks.yml ]; then
            echo "âŒ ERROR: quality-checks.yml does not exist"
            echo "Expected: .github/workflows/quality-checks.yml"
            exit 1
          fi
          echo "âœ… quality-checks.yml exists"

  test-workflow-structure:
    runs-on: ubuntu-latest
    needs: test-workflow-exists
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify workflow name
        run: |
          WORKFLOW_NAME=$(grep -A 1 "^name:" .github/workflows/quality-checks.yml | tail -1 | sed 's/name: //' | tr -d '"')
          if [ "$WORKFLOW_NAME" != "Quality Checks" ]; then
            echo "âŒ ERROR: Workflow name is not 'Quality Checks'"
            echo "Expected: 'Quality Checks'"
            echo "Actual: '$WORKFLOW_NAME'"
            exit 1
          fi
          echo "âœ… Workflow name is correct"

      - name: Verify required jobs exist
        run: |
          REQUIRED_JOBS=("tasks-check" "rust-test" "rust-lint" "commitlint" "markdownlint")

          for job in "${REQUIRED_JOBS[@]}"; do
            if ! grep -q "^  $job:" .github/workflows/quality-checks.yml; then
              echo "âŒ ERROR: Job '$job' not found in quality-checks.yml"
              exit 1
            fi
            echo "âœ… Job '$job' found"
          done

  test-expected-failure:
    runs-on: ubuntu-latest
    steps:
      - name: This test should fail (RED phase)
        run: |
          echo "ğŸ”´ RED Phase: This test is expected to FAIL"
          echo "Reason: quality-checks.yml has not been implemented yet"
          echo ""
          echo "Next step: Implement quality-checks.yml (T006) to make this test PASS (GREEN)"

          # Intentional failure for TDD RED phase
          exit 1
