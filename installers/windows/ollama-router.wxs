<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product
    Id="*"
    Name="Ollama Router"
    Language="1041"
    Version="$(var.ProductVersion)"
    Manufacturer="Ollama Router"
    Codepage="65001"
    UpgradeCode="{B5064C44-1AB8-4AEA-86A1-0B36FEC7B6B7}"
  >
    <Package
      InstallerVersion="500"
      Compressed="yes"
      InstallScope="perMachine"
      Platform="x64"
    />

    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />

    <MajorUpgrade
      AllowDowngrades="no"
      DowngradeErrorMessage="A newer version of Ollama Router is already installed."
    />

    <Feature Id="MainFeature" Title="Ollama Router" Level="1">
      <ComponentGroupRef Id="RuntimeComponents" />
    </Feature>
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="Ollama Router" />
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Ollama Router" />
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <!-- Paths are resolved relative to repository root (workflow runs from repo root) -->
    <Icon Id="CoordIcon" SourceFile="assets\\icons\\router.ico" />
    <Icon Id="AgentIcon" SourceFile="assets\\icons\\node.ico" />
  </Fragment>

  <Fragment>
    <ComponentGroup Id="RuntimeComponents">
      <Component Id="CoordinatorBinary" Directory="INSTALLFOLDER" Guid="{0859444E-7EA4-45FC-8F0F-4B1E4C0C5B2C}" Win64="yes">
        <File
          Id="CoordinatorExe"
          KeyPath="yes"
          Source="$(var.BinariesDir)\or-router.exe"
        />
      </Component>

      <Component Id="AgentBinary" Directory="INSTALLFOLDER" Guid="{A34E05F3-4200-4B88-B583-6D4509708D52}" Win64="yes">
        <File
          Id="AgentExe"
          KeyPath="yes"
          Source="$(var.BinariesDir)\or-node.exe"
        />
      </Component>

      <Component Id="CoordinatorStartMenuShortcut" Directory="ApplicationProgramsFolder" Guid="{66D07D25-2201-47C1-9535-FA9244062B1F}" Win64="yes">
        <Shortcut
          Id="CoordinatorShortcut"
          Name="Ollama Router"
          Description="Ollama Router を起動"
          Target="[INSTALLFOLDER]or-router.exe"
          WorkingDirectory="INSTALLFOLDER"
          Icon="CoordIcon"
          IconIndex="0"
        />
        <RemoveFolder Id="RemoveCoordinatorProgramsFolder" Directory="ApplicationProgramsFolder" On="uninstall" KeyPath="yes" />
        <RegistryValue Root="HKCU" Key="Software\\OllamaRouter" Name="CoordinatorShortcut" Type="integer" Value="1" />
      </Component>

      <Component Id="AgentStartMenuShortcut" Directory="ApplicationProgramsFolder" Guid="{B32759F0-6604-4281-8211-244CC30417B5}" Win64="yes">
        <Shortcut
          Id="AgentShortcut"
          Name="Ollama Router Agent"
          Description="Ollama Router Agent を起動"
          Target="[INSTALLFOLDER]or-node.exe"
          WorkingDirectory="INSTALLFOLDER"
          Icon="AgentIcon"
          IconIndex="0"
        />
        <RemoveFolder Id="RemoveAgentProgramsFolder" Directory="ApplicationProgramsFolder" On="uninstall" KeyPath="yes" />
        <RegistryValue Root="HKCU" Key="Software\\OllamaRouter" Name="AgentShortcut" Type="integer" Value="1" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
